# -*- coding: UTF-8 -*-.
import argparse
import csv
import datetime
from tsne import bh_sne
import matplotlib
# matplotlib.use('Agg')
from matplotlib import pyplot as plt
import numpy as np

def params():
    parser = argparse.ArgumentParser()
    parser.add_argument('input_csv', help='Input CSV Location')
    params = parser.parse_args()
    return params.input_csv

ddm_drifts = [8606, 8923, 15597, 18144, 18285, 19370, 33358, 33393, 34755, 44646, 46991]
eddm_drifts = [8680, 12714, 14854, 15409, 18969, 20538, 25461, 31161, 32783]

# get params
input_csv = params()

# load samples
samples = []
labels = []
with open(input_csv, 'rb') as file:
    reader = csv.DictReader(file)
    for row in reader:
        # convert attribute to float
        item = []
        # iterate over keys and save label in a separate array
        for k in row.keys():
            if k != "label":
                item.append(float(row[k]))
            else:
                labels.append(float(row[k]))
        # append item to samples list
        samples.append(item)

# samples range
s_range = 50
# iterate over drifts found
for d in ddm_drifts:
    before_drift_samples = []
    before_drift_labels = []
    for i in range(d-s_range, d):
        before_drift_samples.append(samples[i])
        before_drift_labels.append(labels[i])
    after_drift_samples = []
    after_drift_labels = []
    for i in range(d+1, d+s_range+1):
        after_drift_samples.append(samples[i])
        after_drift_labels.append(labels[i])
    print before_drift_labels
    print after_drift_labels
    print
    print
    # print samples[d-1], " ", labels[d-1]
    #
    vis_data = bh_sne(np.array(before_drift_samples + after_drift_samples))

    # plot the result
    vis_x = vis_data[:, 0]
    vis_y = vis_data[:, 1]

    plt.scatter(vis_x, vis_y, c=np.array(before_drift_labels+after_drift_labels), cmap=plt.cm.get_cmap("jet", 10))
    plt.legend()
    plt.savefig('tsne_'+str(d)+'.pdf', format='pdf')
