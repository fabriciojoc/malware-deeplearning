# -*- coding: UTF-8 -*-.
import argparse
import csv
from tsne import bh_sne
import matplotlib
matplotlib.use('Agg')
from matplotlib import pyplot as plt
import numpy as np
import sys
sys.path.append("./lib")
# from common import read_file, cross_validation, hot_enconding, concatenate_features, concatenate_features_w2v, prob_to_class, prob_to_class_threshold, headers, random_samples

def params():
    parser = argparse.ArgumentParser()
    parser.add_argument('features_csv', help='Features CSV location')
    params = parser.parse_args()
    return params.features_csv

def read_features(features_csv):
    X = []
    y = []
    with open(features_csv, 'rb') as file:
        reader = csv.DictReader(file)
        for row in reader:
            label = float(row.pop('label'))
            features = np.array(row.values()).astype(float)
            y.append(label)
            X.append(features)
    return np.array(X), np.array(y)

features_csv = params()

X, y = read_features(features_csv)

vis_data = bh_sne(X)

# plot the result
vis_x = vis_data[:, 0]
vis_y = vis_data[:, 1]

plt.scatter(vis_x, vis_y, c=y, cmap=plt.cm.get_cmap("jet", 10))
plt.legend()
plt.savefig('tsne3.pdf', format='pdf')
